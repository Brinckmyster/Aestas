<!-- BEGIN CAj PATCH -->
<button id="show-plan-template" style="margin-bottom:1em;">Show Editable Base Plan Template</button>
<div id="plan-template-modal" style="display:none;position:fixed;top:10vh;left:50%;transform:translateX(-50%);z-index:1002;background:#fff;padding:1.5rem 2rem;border-radius:1em;box-shadow:0 0 16px #222;">
<h3>Meal Plan Template</h3>
<form id="template-form">
<label>Breakfast: <input type="text" name="breakfast" maxlength="40"></label><br>
<label>Lunch: <input type="text" name="lunch" maxlength="40"></label><br>
<label>Dinner: <input type="text" name="dinner" maxlength="40"></label><br>
<label>Snacks: <input type="text" name="snacks" maxlength="40"></label><br>
<br><b>Dietary Restrictions/Needs:</b><br>
<textarea name="restrictions" rows="3" placeholder="gluten free, gastroparesis, kosher, diabetes, vegetarian, allergies, other needs" style="width:98%"></textarea>
<br>
<button type="submit">Save Plan</button>
<button type="button" id="close-template-modal">Cancel</button>
</form>
</div>
<script>
document.getElementById('show-plan-template').onclick=function(){document.getElementById('plan-template-modal').style.display='block'};
document.getElementById('close-template-modal').onclick=function(){document.getElementById('plan-template-modal').style.display='none'};
document.getElementById('template-form').onsubmit=function(e){
  e.preventDefault();
  let plan={
    breakfast: this.breakfast.value||"Oatmeal with fruit",
    lunch: this.lunch.value||"Turkey & cheese sandwich",
    dinner: this.dinner.value||"Rice and chicken stir fry",
    snacks: this.snacks.value||"Yogurt, apple slices",
    restrictions: this.restrictions.value||"None"
  };
  localStorage.setItem('simpleMealPlan',JSON.stringify(plan));
  alert("Plan saved! Click 'Suggest Meals' to use it.");
  document.getElementById('plan-template-modal').style.display='none'
};
document.getElementById('suggest-meals').onclick=function(){
  let plan=null,out=[];
  try{plan=JSON.parse(localStorage.getItem('simpleMealPlan'))}catch{}
  let restxt=plan&&plan.restrictions&&plan.restrictions!=="None"?`Note: ${plan.restrictions}`:"";
  if(plan&&Object.keys(plan).length>0){
    out=[
      {name:"Breakfast",time:"08:00",notes:plan.breakfast+"<br>"+restxt},
      {name:"Lunch",time:"12:00",notes:plan.lunch+"<br>"+restxt},
      {name:"Dinner",time:"18:00",notes:plan.dinner+"<br>"+restxt},
      {name:"Snacks",time:"15:30",notes:plan.snacks+"<br>"+restxt}
    ];
  }else{
    out=[
      {name:"Oatmeal with fruit",time:"08:00",notes:"Breakfast. Classic and easy."},
      {name:"Turkey & cheese sandwich",time:"12:00",notes:"Lunch. Use bread/turkey/cheese or equivalent."},
      {name:"Chicken stir fry with rice",time:"18:00",notes:"Dinner. Quick, reheats well."},
      {name:"Apple slices + yogurt",time:"15:30",notes:"Snack."}
    ];
  }
  let sugDiv=document.getElementById('suggestion-list'); sugDiv.innerHTML="";
  out.forEach(m=>{
    let d=document.createElement('div');
    d.className="suggestion-item";
    d.innerHTML=`<b>${m.name}</b> <span>at ${m.time}</span><br><i>${m.notes}</i>`;
    sugDiv.appendChild(d);
  });
};
</script>
<!-- END CAj PATCH -->
