<!-- Google Integration Component for Academic Allies -->
<section id="google-integration" class="google-integration" aria-label="Google Sign-In and Calendar">
  <h2>Google Integration</h2>
  <div class="google-signin">
    <button id="google-signin-btn" class="google-btn" aria-label="Sign in with Google">
      <span class="google-icon"></span> Sign in with Google
    </button>
    <span id="google-user" class="google-user" style="display:none;"></span>
    <button id="google-signout-btn" class="google-btn" style="display:none;" aria-label="Sign out of Google">
      Sign out
    </button>
  </div>
  <div class="calendar-integration" style="margin-top:1.5em;">
    <button id="calendar-connect-btn" class="calendar-btn" aria-label="Connect Google Calendar" disabled>
      Connect Google Calendar
    </button>
    <button id="calendar-disconnect-btn" class="calendar-btn" style="display:none;" aria-label="Disconnect Google Calendar">
      Disconnect Calendar
    </button>
    <span id="calendar-status" class="calendar-status"></span>
  </div>
  <div class="firebase-status" style="margin-top:1.5em;">
    <span id="firebase-status-label">Firebase: <strong>Not Connected</strong></span>
  </div>
  <style>
    .google-integration { background: #f8fafc; border-radius: 1rem; padding: 1.5rem; max-width: 500px; margin: 2rem auto; box-shadow: 0 2px 8px rgba(0,0,0,0.07);}
    .google-integration h2 { font-size: 1.5rem; margin-bottom: 1rem; color: #22223b;}
    .google-btn, .calendar-btn { background: #3b82f6; color: #fff; border: none; border-radius: 0.5em; padding: 0.6em 1.4em; font-size: 1em; cursor: pointer; transition: background 0.2s; margin-right: 0.5em;}
    .google-btn:focus, .calendar-btn:focus { outline: 2px solid #6366f1;}
    .google-icon { display: inline-block; width: 1.2em; height: 1.2em; background: url('https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg') no-repeat center/contain; vertical-align: middle; margin-right: 0.5em;}
    .google-user { margin-left: 1em; font-weight: 600; color: #22223b;}
    .calendar-status { margin-left: 1em; font-weight: 600; color: #3b82f6;}
    .firebase-status { font-size: 1em; color: #4b5563;}
  </style>
</section>

<!-- Google Identity Services Script -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
  // Google OAuth2 Client ID (do not edit)
  const GOOGLE_CLIENT_ID = "93996985456-ftjjdrj4t32h106o7cmstiuqut32vf0g.apps.googleusercontent.com";

  // Sign-In Button Handler
  document.getElementById('google-signin-btn').addEventListener('click', function() {
    google.accounts.id.initialize({
      client_id: GOOGLE_CLIENT_ID,
      callback: handleCredentialResponse,
    });
    google.accounts.id.prompt();
  });

  // Handle Google Sign-In Response
  function handleCredentialResponse(response) {
    const user = parseJwt(response.credential);
    document.getElementById('google-user').textContent = user.name || user.email || "Signed in";
    document.getElementById('google-user').style.display = 'inline';
    document.getElementById('google-signin-btn').style.display = 'none';
    document.getElementById('google-signout-btn').style.display = 'inline';
    document.getElementById('calendar-connect-btn').disabled = false;
  }

  // Parse JWT to extract user info
  function parseJwt(token) {
    if (!token) return {};
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  }

  // Sign-Out Button Handler
  document.getElementById('google-signout-btn').addEventListener('click', function() {
    document.getElementById('google-user').style.display = 'none';
    document.getElementById('google-signin-btn').style.display = 'inline';
    document.getElementById('google-signout-btn').style.display = 'none';
    document.getElementById('calendar-connect-btn').disabled = true;
    // Optionally revoke token here for extra security
  });

  // Calendar Connect Button Handler (placeholder)
  document.getElementById('calendar-connect-btn').addEventListener('click', function() {
    document.getElementById('calendar-status').textContent = "Calendar connected! (integration coming soon)";
    document.getElementById('calendar-connect-btn').style.display = 'none';
    document.getElementById('calendar-disconnect-btn').style.display = 'inline';
  });

  // Calendar Disconnect Button Handler (placeholder)
  document.getElementById('calendar-disconnect-btn').addEventListener('click', function() {
    document.getElementById('calendar-status').textContent = "";
    document.getElementById('calendar-connect-btn').style.display = 'inline';
    document.getElementById('calendar-disconnect-btn').style.display = 'none';
  });
</script>
